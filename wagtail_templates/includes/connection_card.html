{% load narrative_tags %}
{#
Connection Card Component

Displays a narrative connection between events, showing:
- Connection type (CAUSAL, FORESHADOWING, etc.)
- Strength
- The narrative assertion (description)
- Link to the connected event

Variables:
- connection: NarrativeConnection instance
- direction: "incoming" or "outgoing"
#}

{% with conn_type=connection.connection_type|lower|slugify %}
<div class="group relative p-4 rounded-lg border transition-all duration-200 cursor-pointer
            conn-{{ conn_type }} conn-card hover:shadow-lg"
     onclick="window.location='{% if direction == 'incoming' %}{% pageurl connection.from_event %}{% else %}{% pageurl connection.to_event %}{% endif %}'">
    
    {# Connection type badge #}
    <div class="flex items-center gap-2 mb-2">
        <span class="conn-badge inline-flex items-center gap-1.5 px-2 py-0.5 text-xs font-medium border rounded capitalize"
              onclick="event.stopPropagation(); window.location='{% url 'connection_detail' connection.pk %}'">
            {% include "includes/connection_icon.html" with conn_type=connection.connection_type %}
            {{ connection.connection_type|lower|replace:"_":" " }}
        </span>
        
        {% if connection.strength != 'strong' %}
        <span class="text-xs text-slate-500">Â· {{ connection.strength }}</span>
        {% endif %}
    </div>
    
    {# Description - the narrative assertion #}
    <p class="text-sm text-slate-300 mb-3 leading-relaxed">
        "{{ connection.description }}"
    </p>
    
    {# Target event link #}
    <div class="flex items-center gap-2 text-sm">
        {% if direction == "incoming" %}
            <i data-lucide="arrow-left" class="w-4 h-4 text-slate-500"></i>
            <span class="font-medium text-slate-200 group-hover:text-white transition-colors">
                {{ connection.from_event.title }}
            </span>
        {% else %}
            <i data-lucide="arrow-right" class="w-4 h-4 text-slate-500"></i>
            <span class="font-medium text-slate-200 group-hover:text-white transition-colors">
                {{ connection.to_event.title }}
            </span>
        {% endif %}
    </div>

    {# Episode context #}
    <div class="mt-2 text-xs text-slate-500">
        {% if direction == "incoming" %}
            S{{ connection.from_event.episode.get_parent.specific.season_number }}E{{ connection.from_event.episode.episode_number }}
        {% else %}
            S{{ connection.to_event.episode.get_parent.specific.season_number }}E{{ connection.to_event.episode.episode_number }}
        {% endif %}
    </div>

    {# Hover indicator #}
    <div class="absolute right-4 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity">
        <i data-lucide="arrow-right" class="w-5 h-5" style="color: var(--conn-color)"></i>
    </div>
</div>
{% endwith %}
