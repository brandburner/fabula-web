[build]
builder = "nixpacks"

[deploy]
startCommand = "python manage.py migrate --noinput && python manage.py createsuperuser --noinput || true && python manage.py collectstatic --noinput && python manage.py clear_narrative_data --confirm && python manage.py import_fabula ./fabula_export/s01 && python manage.py import_fabula ./fabula_export/s02 && python manage.py import_fabula ./fabula_export/s03 && python manage.py cleanup_duplicates && python manage.py compute_character_tiers && python manage.py compute_graph_positions --detect-communities && gunicorn fabula_web.wsgi:application --bind 0.0.0.0:$PORT"
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 3
