{% load wagtailcore_tags narrative_tags %}
<a href="{% pageurl event %}"
   class="block p-4 bg-slate-900/50 border border-slate-800 rounded-lg hover:border-amber-500/30 hover:bg-amber-500/5 transition-all group">
    
    {% if show_episode %}
    <div class="text-xs text-slate-500 font-mono mb-1">
        {% get_episode_context event as ep %}{{ ep }} Â· {{ event.episode.title }}
    </div>
    {% endif %}
    
    <div class="font-medium text-slate-200 group-hover:text-amber-300 transition-colors mb-2">
        {{ event.title }}
    </div>
    
    <p class="text-sm text-slate-400 line-clamp-2">
        {{ event.description|striptags|truncatewords:25 }}
    </p>
    
    {# Metadata row #}
    <div class="flex items-center gap-4 mt-3 text-xs text-slate-500">
        {% if event.location %}
        <span class="flex items-center gap-1">
            <i data-lucide="map-pin" class="w-3 h-3"></i>
            {{ event.location.canonical_name|truncate_title:20 }}
        </span>
        {% endif %}
        
        <span class="flex items-center gap-1">
            <i data-lucide="users" class="w-3 h-3"></i>
            {{ event.participations.count }}
        </span>
        
        {% if show_connections %}
        {% with conn_count=event.incoming_connections.count|add:event.outgoing_connections.count %}
        {% if conn_count > 0 %}
        <span class="flex items-center gap-1">
            <i data-lucide="link-2" class="w-3 h-3"></i>
            {{ conn_count }}
        </span>
        {% endif %}
        {% endwith %}
        {% endif %}
    </div>
</a>
