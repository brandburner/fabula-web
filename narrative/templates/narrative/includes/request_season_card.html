{# Request Season Card â€” reusable skeleton-style engagement card        #}
{# Context: series_slug (slug of the series), next_season (integer)     #}

{% if fabula_theme == 'writerly' %}
{# ===== WRITERLY VARIANT ===== #}
<div class="rounded-lg p-5 relative overflow-hidden"
     style="border: 2px dashed var(--f-border-default); background: var(--f-bg-elevated);"
     x-data="{ sent: false, sending: false }">

    {# Season title skeleton #}
    <div class="flex items-center justify-between mb-4">
        <div class="font-medium" style="font-family: var(--f-font-display); color: var(--f-fg-placeholder); font-size: 1.1rem;">
            Season {{ next_season }}
        </div>
        <span class="text-xs px-2 py-0.5 rounded-full"
              style="background: var(--f-accent-primary-bg); color: var(--f-accent-primary); border: 1px solid var(--f-border-accent);">
            Coming soon
        </span>
    </div>

    {# Skeleton episode placeholders #}
    <div class="mt-4 grid grid-cols-2 md:grid-cols-4 gap-2">
        <div class="p-2.5 rounded" style="background: color-mix(in srgb, var(--f-bg-elevated) 60%, var(--f-bg-page)); border: 1px dashed var(--f-border-light);">
            <div class="flex items-center gap-1.5">
                <div class="w-5 h-3 rounded-sm" style="background: var(--f-border-light);"></div>
                <div class="flex-1 h-3 rounded-sm" style="background: var(--f-border-light);"></div>
            </div>
        </div>
        <div class="p-2.5 rounded" style="background: color-mix(in srgb, var(--f-bg-elevated) 60%, var(--f-bg-page)); border: 1px dashed var(--f-border-light);">
            <div class="flex items-center gap-1.5">
                <div class="w-5 h-3 rounded-sm" style="background: var(--f-border-light);"></div>
                <div class="flex-1 h-3 rounded-sm" style="background: var(--f-border-light); width: 70%;"></div>
            </div>
        </div>
        <div class="p-2.5 rounded" style="background: color-mix(in srgb, var(--f-bg-elevated) 60%, var(--f-bg-page)); border: 1px dashed var(--f-border-light);">
            <div class="flex items-center gap-1.5">
                <div class="w-5 h-3 rounded-sm" style="background: var(--f-border-light);"></div>
                <div class="flex-1 h-3 rounded-sm" style="background: var(--f-border-light); width: 85%;"></div>
            </div>
        </div>
        <div class="p-2.5 rounded" style="background: color-mix(in srgb, var(--f-bg-elevated) 60%, var(--f-bg-page)); border: 1px dashed var(--f-border-light);">
            <div class="flex items-center gap-1.5">
                <div class="w-5 h-3 rounded-sm" style="background: var(--f-border-light);"></div>
                <div class="flex-1 h-3 rounded-sm" style="background: var(--f-border-light); width: 60%;"></div>
            </div>
        </div>
    </div>

    {# CTA #}
    <div class="mt-5 flex items-center justify-between">
        <p class="text-xs" style="color: var(--f-fg-placeholder);">
            Interested in seeing this season analysed?
        </p>
        <button
            x-show="!sent"
            x-on:click="
                if (sending) return;
                sending = true;
                fetch('{% url 'record_engagement' %}', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json', 'X-CSRFToken': '{{ csrf_token }}'},
                    body: JSON.stringify({
                        series_slug: '{{ series_slug }}',
                        action: 'request_season',
                        metadata: {next_season: {{ next_season }}}
                    })
                }).then(() => { sent = true; }).catch(() => { sending = false; });
            "
            class="text-xs font-medium px-3 py-1.5 rounded-md transition-all duration-200 cursor-pointer"
            style="color: var(--f-accent-primary-fg); background: var(--f-accent-primary-bg); border: 1px solid var(--f-border-accent);"
            onmouseover="this.style.background='var(--f-border-accent)'; this.style.color='var(--f-fg-inverse)'"
            onmouseout="this.style.background='var(--f-accent-primary-bg)'; this.style.color='var(--f-accent-primary-fg)'"
            x-bind:disabled="sending"
        >
            <span x-show="!sending">Request this season</span>
            <span x-show="sending" x-cloak>Sending...</span>
        </button>
        <span x-show="sent" x-cloak
              class="text-xs font-medium px-3 py-1.5 rounded-md inline-flex items-center gap-1.5"
              style="color: var(--f-accent-green-fg); background: var(--f-accent-green-bg);">
            <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
            Noted, thank you
        </span>
    </div>
</div>

{% else %}
{# ===== DARK VARIANT ===== #}
<div class="p-4 rounded-lg relative overflow-hidden"
     style="border: 2px dashed rgba(51, 65, 85, 0.5); background: rgba(15, 23, 42, 0.25);"
     x-data="{ sent: false, sending: false }">

    <div class="flex items-center justify-between mb-3">
        <div class="text-lg font-semibold text-slate-400">
            Season {{ next_season }}
        </div>
        <span class="text-xs px-2 py-0.5 rounded-full bg-amber-500/10 text-amber-400 border border-amber-500/20">
            Coming soon
        </span>
    </div>

    {# Skeleton episode placeholders #}
    <div class="mt-4 grid grid-cols-2 md:grid-cols-4 gap-2">
        <div class="p-2 rounded" style="background: rgba(30, 41, 59, 0.3); border: 1px dashed rgba(51, 65, 85, 0.4);">
            <div class="flex items-center gap-1.5">
                <div class="w-5 h-3 rounded-sm bg-slate-800"></div>
                <div class="flex-1 h-3 rounded-sm bg-slate-800"></div>
            </div>
        </div>
        <div class="p-2 rounded" style="background: rgba(30, 41, 59, 0.3); border: 1px dashed rgba(51, 65, 85, 0.4);">
            <div class="flex items-center gap-1.5">
                <div class="w-5 h-3 rounded-sm bg-slate-800"></div>
                <div class="flex-1 h-3 rounded-sm bg-slate-800" style="width: 70%;"></div>
            </div>
        </div>
        <div class="p-2 rounded" style="background: rgba(30, 41, 59, 0.3); border: 1px dashed rgba(51, 65, 85, 0.4);">
            <div class="flex items-center gap-1.5">
                <div class="w-5 h-3 rounded-sm bg-slate-800"></div>
                <div class="flex-1 h-3 rounded-sm bg-slate-800" style="width: 85%;"></div>
            </div>
        </div>
        <div class="p-2 rounded" style="background: rgba(30, 41, 59, 0.3); border: 1px dashed rgba(51, 65, 85, 0.4);">
            <div class="flex items-center gap-1.5">
                <div class="w-5 h-3 rounded-sm bg-slate-800"></div>
                <div class="flex-1 h-3 rounded-sm bg-slate-800" style="width: 60%;"></div>
            </div>
        </div>
    </div>

    <div class="mt-4 flex items-center justify-between">
        <p class="text-xs text-slate-500">
            Interested in seeing this season analysed?
        </p>
        <button
            x-show="!sent"
            x-on:click="
                if (sending) return;
                sending = true;
                fetch('{% url 'record_engagement' %}', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json', 'X-CSRFToken': '{{ csrf_token }}'},
                    body: JSON.stringify({
                        series_slug: '{{ series_slug }}',
                        action: 'request_season',
                        metadata: {next_season: {{ next_season }}}
                    })
                }).then(() => { sent = true; }).catch(() => { sending = false; });
            "
            class="text-xs font-medium px-3 py-1.5 rounded-md transition-all cursor-pointer bg-amber-500/10 text-amber-400 border border-amber-500/20 hover:bg-amber-500/20 hover:border-amber-500/40"
            x-bind:disabled="sending"
        >
            <span x-show="!sending">Request this season</span>
            <span x-show="sending" x-cloak>Sending...</span>
        </button>
        <span x-show="sent" x-cloak
              class="text-xs font-medium px-3 py-1.5 rounded-md inline-flex items-center gap-1.5 bg-emerald-500/10 text-emerald-400">
            <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
            Noted, thank you
        </span>
    </div>
</div>
{% endif %}
