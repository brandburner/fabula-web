{% extends "base.html" %}
{% load wagtailcore_tags narrative_tags %}

{% block title %}{{ page.title|md_plain }}{% endblock %}

{% block content %}
{% if fabula_theme == 'writerly' %}
{# ===== WRITERLY SERIES INDEX ===== #}
<article class="min-h-screen pb-16">
    {# Hero section - clean, editorial #}
    <div class="py-16" style="background: var(--f-bg-hero);">
        <div class="max-w-4xl mx-auto px-6 text-center">
            <div class="mb-4">
                <div class="w-12 h-px mx-auto mb-6" style="background: var(--f-border-accent);"></div>
                <span class="text-xs font-medium tracking-widest uppercase" style="color: var(--f-fg-placeholder); letter-spacing: 0.15em;">Series</span>
            </div>
            <h1 style="font-family: var(--f-font-display); color: var(--f-fg-heading); font-size: clamp(2rem, 4vw, 3rem); line-height: 1.15; letter-spacing: -0.02em; font-weight: 400;" class="mb-5">
                {{ page.title }}
            </h1>

            {% if page.description %}
            <div class="max-w-2xl mx-auto leading-relaxed" style="color: var(--f-fg-secondary); font-size: 1.05rem; line-height: 1.7;">
                {{ page.description|md }}
            </div>
            {% endif %}
        </div>
    </div>

    <div class="max-w-4xl mx-auto px-6 pt-8">
        {# Quick Navigation - subtle grid #}
        <div class="grid grid-cols-2 md:grid-cols-3 gap-3 mb-14">
            <a href="{% url 'series_event_index' series_slug=page.slug %}"
               class="group p-5 rounded-lg text-center transition-all duration-200"
               style="background: var(--f-card-bg); border: 1px solid var(--f-card-border); box-shadow: var(--f-card-shadow);"
               onmouseover="this.style.boxShadow='var(--f-card-shadow-hover)'; this.style.borderColor='var(--f-border-accent)'"
               onmouseout="this.style.boxShadow='var(--f-card-shadow)'; this.style.borderColor='var(--f-card-border)'">
                <i data-lucide="zap" class="w-6 h-6 mx-auto mb-2" style="color: var(--f-accent-primary);"></i>
                <div class="font-medium text-sm" style="color: var(--f-fg-heading);">Events</div>
                <div class="text-xs mt-0.5" style="color: var(--f-fg-placeholder);">Story moments</div>
            </a>

            <a href="{% url 'series_character_index' series_slug=page.slug %}"
               class="group p-5 rounded-lg text-center transition-all duration-200"
               style="background: var(--f-card-bg); border: 1px solid var(--f-card-border); box-shadow: var(--f-card-shadow);"
               onmouseover="this.style.boxShadow='var(--f-card-shadow-hover)'; this.style.borderColor='var(--f-accent-green)'"
               onmouseout="this.style.boxShadow='var(--f-card-shadow)'; this.style.borderColor='var(--f-card-border)'">
                <i data-lucide="users" class="w-6 h-6 mx-auto mb-2" style="color: var(--f-accent-green);"></i>
                <div class="font-medium text-sm" style="color: var(--f-fg-heading);">Characters</div>
                <div class="text-xs mt-0.5" style="color: var(--f-fg-placeholder);">Who's who</div>
            </a>

            <a href="{% url 'series_organization_index' series_slug=page.slug %}"
               class="group p-5 rounded-lg text-center transition-all duration-200"
               style="background: var(--f-card-bg); border: 1px solid var(--f-card-border); box-shadow: var(--f-card-shadow);"
               onmouseover="this.style.boxShadow='var(--f-card-shadow-hover)'; this.style.borderColor='var(--f-accent-violet)'"
               onmouseout="this.style.boxShadow='var(--f-card-shadow)'; this.style.borderColor='var(--f-card-border)'">
                <i data-lucide="building-2" class="w-6 h-6 mx-auto mb-2" style="color: var(--f-accent-violet);"></i>
                <div class="font-medium text-sm" style="color: var(--f-fg-heading);">Organizations</div>
                <div class="text-xs mt-0.5" style="color: var(--f-fg-placeholder);">Power structures</div>
            </a>

            <a href="{% url 'series_object_index' series_slug=page.slug %}"
               class="group p-5 rounded-lg text-center transition-all duration-200"
               style="background: var(--f-card-bg); border: 1px solid var(--f-card-border); box-shadow: var(--f-card-shadow);"
               onmouseover="this.style.boxShadow='var(--f-card-shadow-hover)'; this.style.borderColor='var(--f-accent-orange)'"
               onmouseout="this.style.boxShadow='var(--f-card-shadow)'; this.style.borderColor='var(--f-card-border)'">
                <i data-lucide="box" class="w-6 h-6 mx-auto mb-2" style="color: var(--f-accent-orange);"></i>
                <div class="font-medium text-sm" style="color: var(--f-fg-heading);">Objects</div>
                <div class="text-xs mt-0.5" style="color: var(--f-fg-placeholder);">Significant items</div>
            </a>

            <a href="{% url 'series_location_index' series_slug=page.slug %}"
               class="group p-5 rounded-lg text-center transition-all duration-200"
               style="background: var(--f-card-bg); border: 1px solid var(--f-card-border); box-shadow: var(--f-card-shadow);"
               onmouseover="this.style.boxShadow='var(--f-card-shadow-hover)'; this.style.borderColor='var(--f-accent-blue)'"
               onmouseout="this.style.boxShadow='var(--f-card-shadow)'; this.style.borderColor='var(--f-card-border)'">
                <i data-lucide="map-pin" class="w-6 h-6 mx-auto mb-2" style="color: var(--f-accent-blue);"></i>
                <div class="font-medium text-sm" style="color: var(--f-fg-heading);">Locations</div>
                <div class="text-xs mt-0.5" style="color: var(--f-fg-placeholder);">Story geography</div>
            </a>
        </div>

        <hr style="border-color: var(--f-rule-color);" class="mb-10">

        {# Seasons - table of contents style #}
        <section>
            <div class="flex items-center gap-3 mb-8">
                <i data-lucide="film" class="w-5 h-5" style="color: var(--f-accent-blue);"></i>
                <h2 style="font-family: var(--f-font-display); color: var(--f-fg-heading); font-size: 1.25rem; font-weight: 400;">Seasons</h2>
            </div>

            <div class="space-y-5">
                {% for season in seasons %}
                <div class="rounded-lg p-5" style="background: var(--f-card-bg); border: 1px solid var(--f-card-border); box-shadow: var(--f-card-shadow);">
                    <div class="font-medium mb-1" style="font-family: var(--f-font-display); color: var(--f-fg-heading); font-size: 1.1rem;">
                        Season {{ season.season_number }}
                    </div>

                    {% if season.description %}
                    <p class="text-sm mt-2 mb-4" style="color: var(--f-fg-secondary);">
                        {{ season.description|md_plain|truncatewords:20 }}
                    </p>
                    {% endif %}

                    {# Episode list - compact, numbered #}
                    <div class="mt-4 grid grid-cols-2 md:grid-cols-4 gap-2">
                        {% for episode in season.get_children.specific %}
                        <a href="{% url 'series_episode_detail' series_slug=page.slug identifier=episode.fabula_uuid|default:episode.pk %}"
                           class="p-2.5 text-sm rounded transition-all duration-150"
                           style="background: var(--f-bg-elevated); border: 1px solid var(--f-border-light);"
                           onmouseover="this.style.borderColor='var(--f-border-accent)'"
                           onmouseout="this.style.borderColor='var(--f-border-light)'">
                            <span style="color: var(--f-fg-placeholder); font-family: var(--f-font-mono); font-size: 0.75rem;">E{{ episode.episode_number }}</span>
                            <span class="ml-1" style="color: var(--f-fg-primary);">{{ episode.title|truncatewords:3 }}</span>
                        </a>
                        {% endfor %}
                    </div>
                </div>
                {% empty %}
                <div class="text-sm p-4 rounded-lg" style="color: var(--f-fg-tertiary); background: var(--f-bg-elevated); border: 1px solid var(--f-border-light);">
                    No seasons found
                </div>
                {% endfor %}

                {# Request Next Season card #}
                {% if seasons %}
                {% with next_season=seasons|last %}
                {% include "narrative/includes/request_season_card.html" with series_slug=page.slug next_season=next_season.season_number|add:"1" %}
                {% endwith %}
                {% endif %}
            </div>
        </section>
    </div>
</article>

{% else %}
{# ===== DARK SERIES INDEX (original) ===== #}
<article class="min-h-screen pb-16">
    {# Hero section #}
    <div class="relative overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-b from-amber-950/20 via-slate-950 to-slate-950"></div>
        <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-amber-900/10 via-transparent to-transparent"></div>

        <div class="relative max-w-4xl mx-auto px-6 pt-12 pb-8 text-center">
            <h1 class="text-4xl md:text-5xl font-bold text-white mb-4 leading-tight tracking-tight">
                {{ page.title }}
            </h1>

            {% if page.description %}
            <div class="text-lg text-slate-400 leading-relaxed max-w-2xl mx-auto prose prose-invert">
                {{ page.description|md }}
            </div>
            {% endif %}
        </div>
    </div>

    <div class="max-w-4xl mx-auto px-6">
        {# QUICK NAVIGATION #}
        <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-12">
            <a href="{% url 'series_event_index' series_slug=page.slug %}"
               class="p-4 bg-slate-900/50 border border-slate-800 rounded-lg hover:border-amber-500/30 transition-colors group text-center">
                <i data-lucide="zap" class="w-8 h-8 mx-auto text-amber-400 mb-2"></i>
                <div class="font-medium text-slate-200 group-hover:text-amber-300">Events</div>
                <div class="text-xs text-slate-500">Story moments</div>
            </a>

            <a href="{% url 'series_character_index' series_slug=page.slug %}"
               class="p-4 bg-slate-900/50 border border-slate-800 rounded-lg hover:border-emerald-500/30 transition-colors group text-center">
                <i data-lucide="users" class="w-8 h-8 mx-auto text-emerald-400 mb-2"></i>
                <div class="font-medium text-slate-200 group-hover:text-emerald-300">Characters</div>
                <div class="text-xs text-slate-500">Who's who</div>
            </a>

            <a href="{% url 'series_organization_index' series_slug=page.slug %}"
               class="p-4 bg-slate-900/50 border border-slate-800 rounded-lg hover:border-violet-500/30 transition-colors group text-center">
                <i data-lucide="building-2" class="w-8 h-8 mx-auto text-violet-400 mb-2"></i>
                <div class="font-medium text-slate-200 group-hover:text-violet-300">Organizations</div>
                <div class="text-xs text-slate-500">Power structures</div>
            </a>

            <a href="{% url 'series_object_index' series_slug=page.slug %}"
               class="p-4 bg-slate-900/50 border border-slate-800 rounded-lg hover:border-amber-500/30 transition-colors group text-center">
                <i data-lucide="box" class="w-8 h-8 mx-auto text-amber-400 mb-2"></i>
                <div class="font-medium text-slate-200 group-hover:text-amber-300">Objects</div>
                <div class="text-xs text-slate-500">Significant items</div>
            </a>

            <a href="{% url 'series_location_index' series_slug=page.slug %}"
               class="p-4 bg-slate-900/50 border border-slate-800 rounded-lg hover:border-blue-500/30 transition-colors group text-center">
                <i data-lucide="map-pin" class="w-8 h-8 mx-auto text-blue-400 mb-2"></i>
                <div class="font-medium text-slate-200 group-hover:text-blue-300">Locations</div>
                <div class="text-xs text-slate-500">Story geography</div>
            </a>
        </div>

        <hr class="border-slate-800 mb-8">

        {# SEASONS #}
        <section>
            <div class="flex items-center gap-2 mb-6">
                <i data-lucide="film" class="w-5 h-5 text-blue-400"></i>
                <h2 class="text-lg font-semibold text-white">Seasons</h2>
            </div>

            <div class="space-y-4">
                {% for season in seasons %}
                <div class="p-4 bg-slate-900/50 border border-slate-800 rounded-lg">
                    <div class="text-lg font-semibold text-slate-200">
                        Season {{ season.season_number }}
                    </div>

                    {% if season.description %}
                    <p class="text-sm text-slate-400 mt-2">
                        {{ season.description|md_plain|truncatewords:20 }}
                    </p>
                    {% endif %}

                    {# Episode list #}
                    <div class="mt-4 grid grid-cols-2 md:grid-cols-4 gap-2">
                        {% for episode in season.get_children.specific %}
                        <a href="{% url 'series_episode_detail' series_slug=page.slug identifier=episode.fabula_uuid|default:episode.pk %}"
                           class="p-2 text-sm bg-slate-800/50 rounded hover:bg-slate-800 transition-colors">
                            <span class="text-slate-500 font-mono">E{{ episode.episode_number }}</span>
                            <span class="text-slate-300 ml-1">{{ episode.title|truncatewords:3 }}</span>
                        </a>
                        {% endfor %}
                    </div>
                </div>
                {% empty %}
                <div class="text-slate-500 text-sm p-4 bg-slate-900/30 rounded-lg border border-slate-800/50">
                    No seasons found
                </div>
                {% endfor %}

                {# Request Next Season card #}
                {% if seasons %}
                {% with next_season=seasons|last %}
                {% include "narrative/includes/request_season_card.html" with series_slug=page.slug next_season=next_season.season_number|add:"1" %}
                {% endwith %}
                {% endif %}
            </div>
        </section>
    </div>
</article>
{% endif %}
{% endblock %}
